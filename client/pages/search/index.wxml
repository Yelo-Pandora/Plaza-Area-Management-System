<!-- 搜索：区域 & 活动 -->
<view class="search-page">
	<view class="search-header">
		<view class="search-bar">
			<!-- 左侧下拉菜单 -->
			<picker bindchange="bindTypeChange" value="{{typeIndex}}" range="{{searchTypes}}">
				<view class="type-selector">
					<text>{{searchTypes[typeIndex]}}</text>
					<view class="arrow-down"></view>
				</view>
			</picker>		
			<!-- 垂直分割线 -->
			<view class="search-divider"></view>
			<!-- 输入框 -->
			<input 
				class="search-input" 
				placeholder="{{placeholderList[typeIndex]}}" 
				placeholder-class="placeholder"
				value="{{keyword}}" 
				bindinput="onInput"
				confirm-type="search"
				bindconfirm="doSearch"
			/>
			<!-- 搜索按钮 -->
			<view class="search-btn" bindtap="doSearch">搜索</view>
		</view>
	</view>

	<!-- 搜索结果区域 -->
  	<view class="results-container">
		<!-- 商铺搜索结果 -->
		<view class="section" wx:if="{{storeResults.length > 0}}">
			<view class="section-title">商铺</view>
			<view 
				class="result-item" 
				wx:for="{{storeResults}}" 
				wx:key="id" 
				bindtap="openStore" 
				data-id="{{item.id}}"
			>
				<view class="act-title">{{item.store_name}}</view>
				<view class="act-meta">营业时间：{{item.open_time}} 至 {{item.close_time}}</view>
			</view>
		</view>
		<!-- 活动搜索结果 -->
		<view class="section" wx:if="{{eventResults.length > 0}}">
			<view class="section-title">活动</view>
			<view 
				class="result-item" 
				wx:for="{{eventResults}}" 
				wx:key="id" 
				bindtap="openEvent" 
				data-id="{{item.id}}"
			>
				<view class="act-title">{{item.event_name}}</view>
				<view class="act-meta">活动时间：{{item.start_date}} 至 {{item.end_date}}</view>
			</view>
		</view>
		<!-- 只有当点击过搜索，且两个数组都为空时，才显示 -->
		<view class="empty" wx:if="{{hasSearched && storeResults.length === 0 && eventResults.length === 0}}">
			未找到相关内容
		</view>
  	</view>

	<!-- 详情弹窗 -->
	<view class="modal-mask" wx:if="{{showModal}}" bindtap="closeModal">
		<view class="modal-content" catchtap="none">
			<view class="modal-header">
				<text class="modal-title">{{modalType === 'store' ? '商铺详情' : '活动详情'}}</text>
				<view class="close-icon" bindtap="closeModal">关闭</view>
			</view>
			
			<scroll-view scroll-y class="modal-body">
				<view wx:if="{{modalLoading}}" class="modal-loading">加载中...</view>
				
				<block wx:else>
					<!-- 商铺详情视图 -->
					<view wx:if="{{modalType === 'store'}}">
						<!-- 左侧图片，右侧名称与种类 -->
						<view class="store-main-header">
							<!-- 商铺图片：设置 mode="aspectFill" 确保正方形裁剪填充 -->
							<image 
								class="store-main-image" 
								src="{{modalDetail.image_url || '/images/default-store.png'}}" 
								mode="aspectFill"
							/>
							<view class="store-header-text">
								<view class="store-name-large">{{modalDetail.store_name}}</view>
								<view class="store-tags">
									<view class="store-type-tag">
										{{storeTypeMap[modalDetail.type] != null ? storeTypeMap[modalDetail.type] : '其他'}}
									</view>
									<view class="status-tag {{modalDetail.isOpen ? 'is-open' : 'is-closed'}}">
										{{modalDetail.statusLabel}}
									</view>
								</view>
							</view>
						</view>
						<!-- 分割线 -->
						<view class="modal-divider"></view>
						<!-- 其他详细信息列表 -->
						<view class="detail-row">
							<text class="label">营业时间：</text>
							<text class="value">{{modalDetail.open_time}} - {{modalDetail.close_time}}</text>
						</view>
						<view class="detail-row">
							<text class="label">租户姓名：</text>
							<text class="value">{{modalDetail.owner_name}}</text>
						</view>
						<view class="detail-row">
							<text class="label">租户电话：</text>
							<text class="value">{{modalDetail.owner_phone}}</text>
						</view>
						<view class="detail-row">
							<text class="label">商铺简介：</text>
							<text class="value">{{modalDetail.description || '暂无简介'}}</text>
						</view>
						<view class="detail-row" wx:if="{{modalDetail.api_url}}">
							<text class="label">商铺链接：</text>
							<view 
								class="value url-link" 
								bindtap="handleLinkTap" 
								data-url="{{modalDetail.api_url}}"
							>
								点击复制并访问
							</view>
						</view>
						<!-- 分割线 -->
						<view class="modal-divider"></view>
						<!-- TODO: 还需要实现在地图中查看的按钮,这里向openInMap的传参可能需要修改 -->
						<view 
							class="map-location-btn" 
							bindtap="openInMap" 
							wx:if="{{modalDetail.shape}}"
						>
							<text >在地图中查看</text>
						</view>
					</view>

					<!-- 活动详情视图 -->
					<view wx:if="{{modalType === 'event'}}">
						<view class="detail-row">
							<text class="label">活动名称：</text>
							<text class="value">{{modalDetail.event_name}}</text>
						</view>
						<view class="detail-row">
							<text class="label">活动周期：</text>
							<text class="value">{{modalDetail.start_date}} \n {{modalDetail.end_date}}</text>
						</view>
						
						<!-- TODO: 关联区域列表还未实现完善 -->
						<view class="sub-section" wx:if="{{modalRelatedAreas.length > 0}}">
							<view class="sub-title">关联区域列表</view>
							<view class="mini-card" wx:for="{{modalRelatedAreas}}" wx:key="id">
								关联区域信息
								<!-- <text>{{item.store_name || item.name}}</text>
								<text class="tag">{{modal_type === 'store' ? '商铺活动' : '区域活动'}}</text> -->
							</view>
						</view>
					</view>
				</block>
			</scroll-view>

			<!-- <view class="modal-footer">
				<view class="btn" bindtap="closeModal">关闭</view>
			</view> -->
		</view>
	</view>
</view>